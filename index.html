<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Balpreet Singh - Unity Team Lead / Senior Game Developer</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/images/favicon.png" type="image/x-icon" rel="icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>

  <!-- CDN CSS Files -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- NO Google Analytics here - loaded conditionally by AnalyticsManager -->
</head>

<body class="index-page">

  <!-- Managers -->
  <script src="js/managers/ImageManager.js"></script>
  <script src="js/managers/CSSManager.js"></script>
  <script src="js/managers/SectionManager.js"></script>
  <script src="js/managers/NavigationManager.js"></script>
  <script src="js/managers/PreloaderManager.js"></script>
  <script src="js/managers/ModalManager.js"></script>
  <script src="js/managers/DataUsageTracker.js"></script>


  <!-- Analytics & Tracking System -->
  <!-- <script src="js/managers/AnalyticsManager.js"></script> -->
  <!-- <script src="js/managers/TrackingConsentManager.js"></script> -->

  <!-- AI -->
  <!-- <script src="js/managers/ChatWidget.js"></script> -->
  <!-- <script src="js/ai-assistant/ContentMapper.js"></script> -->

  <!-- Modals-->
  <!-- <script src="js/components/projectModal.js"></script> -->
  <!-- <script src="js/components/gameInfoModal.js"></script> -->
  <!-- <script src="js/components/skillsModal.js"></script> -->


  <!-- Section Tracking -->
  <script src="js/tracking/tracking-herosection.js"></script>
  <script src="js/tracking/tracking-portfolio.js"></script>
  <script src="js/tracking/tracking-skills.js"></script>
  <script src="js/tracking/tracking-experience.js"></script>
  <script src="js/tracking/tracking-contact.js"></script>
  <script src="js/tracking/tracking-testimonials.js"></script>

  <!-- Modal Tracking -->
  <!-- <script src="js/tracking/modals/tracking-gameInfoModal.js"></script> -->
  <!-- <script src="js/tracking/modals/tracking-projectModal.js"></script> -->
  <!-- <script src="js/tracking/modals/tracking-skillsModal.js"></script> -->




  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center">
    <i class="bi bi-arrow-up"></i>
  </a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- CDN JS Files -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

  <!-- Application Initialization -->
  <script>
    document.addEventListener('DOMContentLoaded', async function () {
      try {
        console.log('Initializing portfolio website...');

        // 1. Initialize PreloaderManager first
        window.preloaderManager = new PreloaderManager();

        // 2. Load CSS files first via CSSManager
        await window.CSSManager.loadPreloaded();
        console.log('CSS files loaded');

        // 3. Register all sections with SectionManager
        registerSections();
        initializeChatWidget();

        // 4. Render all sections
        await window.sectionManager.renderAllSections();
        console.log('All sections rendered');

        // 5. Initialize core functionality (but don't remove preloader yet)
        await initializeCoreFeatures(false); // Pass false to skip preloader removal

        // 6. Initialize NavigationManager after sections are rendered
        setTimeout(() => {
          initializeNavigationManager();
        }, 200);

        // 7. Initialize ContentMapper
        window.contentMapper = new ContentMapper();
        await window.contentMapper.init();
        console.log('ContentMapper ready');

        // 8. Initialize Analytics Manager (ready to receive consent)
        initializeAnalyticsManager();

        // 9. Initialize Tracking Consent Manager (shows footer notification)
        initializeTrackingConsent();

        // 10. Mark loading as complete - this triggers the enhanced preloader animation
        await window.preloaderManager.markLoadingComplete();

        // 11. NEW: Mark data tracking as complete
        if (window.dataUsageTracker) {
          window.dataUsageTracker.markRenderingComplete('initialization_complete');
        }

        console.log('Portfolio website initialized successfully');

      } catch (error) {
        console.error('Error initializing portfolio website:', error);
        // Fallback: force remove preloader if there's an error
        if (window.preloaderManager) {
          window.preloaderManager.forceRemove();
        }
      }
    });

    /**
     * Initialize Analytics Manager
     */
    function initializeAnalyticsManager() {
      if (window.AnalyticsManager && window.analyticsManager) {
        console.log('Analytics Manager initialized and ready for consent');

        // Analytics is now ready but won't track until consent is given
        // The TrackingConsentManager will call analyticsManager.init() when user consents

        // Test analytics (only logs when no consent)
        window.analyticsManager.trackEvent('app_initialized', {
          timestamp: Date.now(),
          user_agent: navigator.userAgent.substring(0, 100)
        });

      } else {
        console.error('AnalyticsManager not found');
      }
    }

    /**
     * Initialize Tracking Consent System
     */
    function initializeTrackingConsent() {
      if (window.TrackingConsentManager) {
        // TrackingConsentManager is already initialized globally as window.trackingConsent
        // Check for consent and show footer notification if needed
        window.trackingConsent.checkConsent();
        console.log('Tracking consent system initialized');
      } else {
        console.error('TrackingConsentManager not found');
      }
    }

    /**
     * Register all sections with their configurations
     */
    function registerSections() {
      const sections = [
        {
          id: 'header',
          class: 'HeaderSection',
          container: 'body',
          order: 0,
          loadJS: true
        },
        {
          id: 'hero',
          class: 'HeroSection',
          container: 'main',
          order: 1,
          loadJS: true
        },
        {
          id: 'game',
          class: 'GameSection',
          container: 'main',
          order: 2,
          loadJS: true
        },
        {
          id: 'portfolio',
          class: 'PortfolioSection',
          container: 'main',
          order: 3,
          loadJS: true
        },
        {
          id: 'skills',
          class: 'SkillsSection',
          container: 'main',
          order: 4,
          loadJS: true
        },
        {
          id: 'experience',
          class: 'ExperienceSection',
          container: 'main',
          order: 5,
          loadJS: true
        },
        {
          id: 'testimonials',
          class: 'TestimonialsSection',
          container: 'main',
          order: 6,
          loadJS: true
        },
        {
          id: 'contact',
          class: 'ContactSection',
          container: 'main',
          order: 7,
          loadJS: true
        },
        {
          id: 'footer',
          class: 'FooterSection',
          container: 'body',
          order: 8,
          loadJS: true
        }
      ];

      window.sectionManager.registerSections(sections);
      console.log('Sections registered:', sections.map(s => s.id));
    }

    /**
     * Initialize core website features
     */
    async function initializeCoreFeatures(removePreloader = true) {
      if (removePreloader) {
        const preloader = document.querySelector('#preloader');
        if (preloader) {
          preloader.remove();
        }
      }

      initializeHeaderToggle();
      initializeScrollTop();

      if (typeof AOS !== 'undefined') {
        AOS.init({
          duration: 800,
          easing: 'ease-in-out',
          once: true,
          mirror: false
        });
        console.log('AOS initialized');
      }
    }

    function initializeHeaderToggle() {
      const headerToggleBtn = document.querySelector('.header-toggle');
      const header = document.querySelector('#header');

      if (headerToggleBtn && header) {
        headerToggleBtn.addEventListener('click', function () {
          header.classList.toggle('header-show');
          headerToggleBtn.classList.toggle('bi-list');
          headerToggleBtn.classList.toggle('bi-x');
        });
        console.log('Header toggle initialized');
      }
    }

    function initializeChatWidget() {
      if (window.ChatWidget && window.modalManager) {
        window.chatWidget = new ChatWidget();
        console.log('ChatWidget initialized');
      } else {
        setTimeout(initializeChatWidget, 500);
      }
    }

    function initializeScrollTop() {
      const scrollTop = document.querySelector('.scroll-top');

      if (scrollTop) {
        function toggleScrollTop() {
          window.scrollY > 100
            ? scrollTop.classList.add('active')
            : scrollTop.classList.remove('active');
        }

        scrollTop.addEventListener('click', (e) => {
          e.preventDefault();
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });

        window.addEventListener('scroll', toggleScrollTop);
        toggleScrollTop();

        console.log('Scroll top functionality initialized');
      }
    }

    function initializeNavigationManager() {
      if (window.NavigationManager) {
        window.navigationManager = new NavigationManager();
        console.log('NavigationManager initialized');
      } else {
        console.error('NavigationManager class not found');
      }
    }

  </script>
</body>

</html>